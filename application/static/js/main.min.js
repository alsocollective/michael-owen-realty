var app={options:{loadingpage:!1,pagetransitiontime:1e3,previousURL:null,slickinstance:null},init:function(){app.social.init(),$("nav a").click(app.nav.navmenueclick),app.url.init(),$("#navbutton").click(app.nav.togglemenue),app.url.setupPagescroll(".mainwrapper"),app.resize(),$(window).resize(app.resize),$(window).on("popstate",app.url.changepage)},nav:{navmenueclick:function(a){if(!this.href||!a.preventDefault)return!1;var b=this.href,c=b.split(":")[0];return"mailto"!=c&&"tel"!=c?app.options.loadingpage?(a.preventDefault(),!1):(app.nav.loadpage(this.href),$("#navbutton").hasClass("navactive")&&app.nav.togglemenue(),!1):void 0},loadpage:function(a,b){if(app.options.loadingpage=!0,b){var c=a.split("/"),d=c[c.length-1],c="/"+d;app.nav.changeurl(c)}else app.url.seturlfromfull(a);var e=document.createElement("div");e.className="mainwrapper offright",document.body.appendChild(e),$(e).load(a,function(){$.waypoints("destroy");var a=$(".mainwrapper"),b=$(a[0]),c=$(a[1]);b.addClass("offleft"),setTimeout(function(){c.removeClass("offright")},2*app.options.pagetransitiontime),app.nav.deleteEl(b[0],app.options.pagetransitiontime),app.url.gotohashlocation(),app.options.previousURL=document.URL.split("#")[0]})},deleteEl:function(a,b){setTimeout(function(){app.options.loadingpage=!1,a.parentNode.removeChild(a),app.url.setupPagescroll(".mainwrapper")},b)},togglemenue:function(){$("nav").toggleClass("offleft"),$("#navbutton").toggleClass("navactive")},changeurl:function(a){$(".currentpage").removeClass("currentpage"),$($('a[href="'+a+'"]')[0].parentNode).addClass("currentpage")},correctSize:function(){$("#nav").width($($(".mainwrapper div")[0]).width())},splashsize:function(){$("#splash, #smallsplash").height($(window).height()-100)}},social:{init:function(){$(".twitterlink").click(app.social.twitterLink)},twitterLink:function(a){a.preventDefault(),a.stopPropagation();window.open(this.href,this.target||"_blank","menubar=no,toolbar=no,location=no,directories=no,status=no,scrollbars=no,resizable=no,dependent,width=475,height=248,left=0,top=0");return!1}},url:{init:function(){app.options.previousURL=document.URL.split("#")[0],app.url.gotohashlocation()},seturlfromfull:function(a){var a=a.split("/"),b=a[a.length-1],a="/"+b;return window.history.pushState({id:b,path:a},b,a),app.nav.changeurl(a),app.options.previousURL=document.URL,!1},setupPagescroll:function(a){var b=$(a+" h2");b.waypoint(app.url.setSectionAsHash,{context:".mainwrapper"})},setSectionAsHash:function(a){return!1},gotohashlocation:function(){$(location.hash)},findPage:function(a){for(var b=a.split("/"),c="",d=1;c.length<=0;)c=b[b.length-d],++d;return c},currentPage:function(){return $("#searchfield").length>0?"search":$("#about").length>0?"about":$(".sellingpage").length>0?"sell":$(".buyingpage")?"buy":"Unknown"},changepage:function(){var a=document.URL.split("#"),b=app.url.findPage(a[0]),c=app.url.currentPage();if(b.length>8&&(b="about"),a.length>1&&a[1].length>1)$(".module")[0]||app.property.loadproperty(null,a[1]);else if(c!=b)console.log(c,b),app.nav.loadpage(document.URL,!0);else{var d=$(".module");d.length>0&&(d=d[0],d.parentNode.removeChild(d))}return!1}},about:{init:function(){$(".reference").slick({dots:!0,arrows:!1,autoplay:!0,autoplaySpeed:1e4}),app.property.setup(),app.nav.splashsize()}},search:{init:function(){app.search.setuppriceSlider(),app.search.setupBedSlider(),app.search.setupBathSlider(),app.property.setup(),app.search.neighbourhoodSetup(),app.search.initajax(),app.search.setupCheckAllButtons(),app.search.setupDeletinputonselect(),app.nav.splashsize(),app.search.setupResultsSlick()},initajax:function(){$("#searchlistings button").click(app.search.loadInitialContent),$("#morelistings").click(app.search.loadmorelistings)},loadmorelistings:function(){var a=$(this).find("input")[0].value;app.search.updatefrom(a),a.csrfmiddlewaretoken=propertySettings.csrftoken,$.ajax({type:"POST",url:"/proplist/",data:a,success:app.search.loadsuccessappend})},updatefrom:function(a){var b=a.split("=");b=b[b.length-1],a=a.substring(0,a.length-b.length),b=parseInt(b)+12,$("#morelistings").removeClass("hide"),$("#morelistings input")[0].value=a+b},loadInitialContent:function(){var a=$(".filterform"),b=app.search.checkifinputisgood(a);if($(".erroronsearch").removeClass("erroronsearch"),0!=b){for(var c=0,d=b.length;d>c;++c)$(".filterform ."+b[c]).addClass("erroronsearch"),console.log(b[c]);return!1}a=a.serialize(),app.search.updatefrom(a),a.csrfmiddlewaretoken=propertySettings.csrftoken,$.ajax({type:"POST",url:"/proplist/",data:a,success:app.search.loadsuccess})},checkifinputisgood:function(a){var b=!1,c=parseInt(a.find("#lowerprice").val().replace(",","").replace(",","").replace("$","")),d=parseInt(a.find("#upperprice").val().replace(",","").replace(",","").replace("$","")),e=parseInt(a.find("#lowerbed").val()),f=parseInt(a.find("#upperbed").val()),g=parseFloat(a.find("#lowerbath").val()),h=parseFloat(a.find("#upperbath").val()),i=a.find(".neighbourhoodslist :checked");return 1e5>d-c&&(b=app.search.addtoreturn(b,"priceselector")),1>f-e&&(b=app.search.addtoreturn(b,"bedroomselector")),1>h-g&&(b=app.search.addtoreturn(b,"bathroomselector")),i.length>0&&i.length<3&&(b=app.search.addtoreturn(b,"neighbourhoodslist")),b},addtoreturn:function(a,b){return 0==a?a=[b]:a.push(b),a},loadsuccess:function(a){for(var b=app.search.loadedlength();b>1;)app.options.searchresults.slickRemove(b-1),b=app.search.loadedlength();a.length<20?(app.options.searchresults.slickAdd("<div><div class='grid'><h3 class='centertext column6'>There was no properties that matches this query,<br>please change your search parameters.</h3></div></div>"),$("#morelistings").addClass("hide")):app.options.searchresults.slickAdd("<div><ul class='propertylist leftmargin'>"+a+"</ul></div>"),app.options.searchresults.slickGoTo(app.search.loadedlength()-1),app.property.setup()},loadedlength:function(){return $("#searchresults .slick-track .slick-slide").length-2},loadsuccessappend:function(a){return a.length<100?($("#morelistings").addClass("hide"),!1):(app.options.searchresults.slickAdd("<div><ul class='propertylist leftmargin'>"+a+"</ul></div>"),app.options.searchresults.slickGoTo(app.search.loadedlength()-1),app.search.gotosearchlistings(),void app.property.setup())},responcefromInitialLoad:function(){console.log("submit was triggered")},setuppriceSlider:function(){var a=$(".offright #priceslider a");0==a.length&&(a=$("#priceslider")),a.noUiSlider({start:[0,8e5],connect:!0,behaviour:"drag",margin:1e5,range:{min:[0],max:[15e5]},format:wNumb({mark:".",decimals:0,thousand:",",prefix:"$ "}),step:1e4}),a.Link("lower").to($("#lowerprice")),a.Link("upper").to($("#upperprice"))},setupBedSlider:function(){var a=$(".offright #bedslider");0==a.length&&(a=$("#bedslider")),a.noUiSlider({start:[1,3],connect:!0,behaviour:"drag",margin:1,range:{min:[propertySettings.bed.min],max:[propertySettings.bed.max]},format:wNumb({mark:".",decimals:0}),step:1}),a.Link("lower").to($("#lowerbed")),a.Link("upper").to($("#upperbed"))},setupBathSlider:function(){var a=$(".offright #bathslider");0==a.length&&(a=$("#bathslider")),a.noUiSlider({start:[1,3],connect:!0,margin:1,behaviour:"drag",range:{min:[propertySettings.bath.min],max:[propertySettings.bath.max]},format:wNumb({mark:".",decimals:1}),step:.5}),a.Link("lower").to($("#lowerbath")),a.Link("upper").to($("#upperbath"))},neighbourhoodSetup:function(){$("#neighbourhoods a").click(app.search.neighbourhoodClick)},neighbourhoodClick:function(a){return $("#neighbourhoodajax").load(this.href),a.preventDefault(),!1},setupCheckAllButtons:function(){$(".filterform .bold").parent().find("input").change(app.search.checkAllRelatedCheckboxes)},checkAllRelatedCheckboxes:function(){$(this.parentNode.parentNode).find("input").each(this.checked?app.search.makeCheck:app.search.makeUnCheck)},makeCheck:function(a,b){b.checked=!0},makeUnCheck:function(a,b){b.checked=!1},setupDeletinputonselect:function(){$("input").click(app.search.deletinputonselect)},deletinputonselect:function(){this.value=""},setupResultsSlick:function(){app.options.searchresults=$("#searchresults").slick({adaptiveHeight:!0})},gotosearchlistings:function(){$(".mainwrapper").animate({scrollTop:-1*$("#searchlistings").offset().top},1e3)}},sell:{init:function(){console.log("sell setting up"),app.sell.slicksetup(),app.nav.splashsize()},slicksetup:function(){$(".pullquotes").slick({dots:!0,arrows:!1,slidesToShow:1,adaptiveHeight:!1,autoplay:!0,autoplaySpeed:1e4})}},property:{init:function(){$(".module").hasClass("moduleindex")||$(".module").click(app.property.deleteprop),$(".module > div > div").click(app.property.stopprop),app.property.resizemap(),app.property.coppyInit(),app.email.init(),app.property.exitbutton(),$(".module").addClass("loaded")},exitbutton:function(){$("#exbutton > div, .closebigbutton").click(app.property.exitbuttonexit)},exitbuttonexit:function(){var a=this.parentNode.parentNode.parentNode.parentNode.parentNode;a&&a.parentNode&&a.parentNode.removeChild(a)},initslick:function(){function a(){app.options.slickinstance[0].slick.setPosition()}app.options.slickinstance=$(".propertyimages").slick({dots:!1,arrows:!0,slidesToShow:1,adaptiveHeight:!0,autoplay:!0,autoplaySpeed:5e3}),$(".propertyimages img").load(a)},resizemap:function(){var a=$("#gmap iframe");a.height(.8*a.width())},deleteprop:function(){this.parentNode&&(this.parentNode.removeChild(this),location.hash="")},setup:function(){$(".propertylist li.new").click(app.property.loadproperty).each(app.property.removenewclass),app.property.coppyInit(),$(".share").click(app.property.toggleclicked)},removenewclass:function(){$(this).removeClass("new")},toggleclicked:function(a){return $(a.target).hasClass("emaillink")?(a.stopPropagation(),app.property.coppyText("opening email","Get more info from Michael"),!0):(a.preventDefault(),$(this).toggleClass("clicked"),!1)},loadproperty:function(a,b){if(a&&(a.preventDefault(),$(a.target).hasClass("emaillink")||$(a.target).hasClass("twitterlink")||$(a.target).hasClass("coppylink")||$(a.target).hasClass("share")||"share"==a.target.innerHTML))return console.log(a.target),!1;var c=$(this).find("a")[0];if(a?a.preventDefault():c.href="/property/"+b,app.options.loadingpage)return!1;var d=document.createElement("div");return d.className="module",document.body.appendChild(d),$(d).load(c.href,app.property.loadedproperty),a.stopPropagation(),!1},stopprop:function(a){$(a.target).hasClass("emaillink")||a.stopPropagation()},loadedproperty:function(){app.property.init(),location.hash=$(".module > div")[0].id},loadrestofphotos:function(a){$.ajax({dataType:"json",url:"/newimages/"+a,success:app.property.addednewimages})},addednewimages:function(a){for(var b="",c=1;c<a.count;++c)b+='<div><img src="/static/images/'+a.id+"-"+c+'.jpg"></div>';$(".propertyimages").html(b),app.property.initslick()},coppyInit:function(){var a=$(".coppylink");if(0==a.length)return!1;a.click(app.property.coppyclicked);var b=new ZeroClipboard(a);b.on("copy",function(a){console.log(a.target.href);var b=a.clipboardData;b.setData("text/plain",a.target.href)});document.createElement("div"),document.createElement("h3")},coppyText:function(a,b){var c=document.createElement("div"),d=document.createElement("p");c.appendChild(d),c.className="overlaycopytext",d.innerHTML=a+':<br>"'+b+'"',document.body.appendChild(c),setTimeout(app.property.deleteCoppyText,app.options.pagetransitiontime+250)},deleteCoppyText:function(){var a=$(".overlaycopytext")[0];a.parentNode.removeChild(a)},coppyclicked:function(a){return a.preventDefault(),a.stopPropagation(),0==$(".overlaycopytext").length&&app.property.coppyText("copied to clipboard",this.href),!1}},email:{init:function(){$(".emailsubmit").click(app.email.submit)},submit:function(a){a.stopImmediatePropagation(),a.preventDefault();var b=$(this.parentNode).serialize();return b.csrfmiddlewaretoken=app.email.csrftoken,$(this.parentNode).addClass("hideform"),$.ajax({type:"POST",url:"/sendemail/",data:b,success:app.email.submitsuccess,error:app.email.error}),!1},submitsuccess:function(a){var b=document.createElement("div");b.className=a.status+" message";var c=document.createElement("h3");c.innerHTML=a.message,b.appendChild(c),$(".request").append(b),$(".requestform").addClass("hideform")},error:function(a){console.log("ERER"),console.log(a)}},resize:function(){app.nav.correctSize(),app.property.resizemap(),app.nav.splashsize()},getCookie:function(a){var b=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b},csrfSafeMethod:function(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}};