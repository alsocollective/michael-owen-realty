var app={options:{loadingpage:!1,pagetransitiontime:1e3,previousURL:null},init:function(){$("nav a").click(app.nav.navmenueclick),app.url.init(),$("#navbutton").click(app.nav.togglemenue),app.url.setupPagescroll(".mainwrapper"),app.resize(),$(window).resize(app.resize),$(window).on("popstate",app.url.changepage)},nav:{navmenueclick:function(a){if(!this.href||!a.preventDefault)return!1;var b=this.href,c=b.split(":")[0];return"mailto"!=c&&"tel"!=c?app.options.loadingpage?(a.preventDefault(),!1):(app.nav.loadpage(this.href),$("#navbutton").hasClass("navactive")&&app.nav.togglemenue(),!1):void 0},loadpage:function(a,b){if(app.options.loadingpage=!0,b){var c=a.split("/"),d=c[c.length-1],c="/"+d;app.nav.changeurl(c)}else app.url.seturlfromfull(a);a=app.url.addajax(a);var e=document.createElement("div");e.className="mainwrapper offright",document.body.appendChild(e),$(e).load(a,function(){$.waypoints("destroy");var a=$(".mainwrapper"),b=$(a[0]),c=$(a[1]);b.addClass("offleft"),setTimeout(function(){c.removeClass("offright")},app.options.pagetransitiontime),app.nav.deleteEl(b[0],app.options.pagetransitiontime),app.url.gotohashlocation(),app.options.previousURL=document.URL.split("#")[0]})},deleteEl:function(a,b){setTimeout(function(){app.options.loadingpage=!1,a.parentNode.removeChild(a),app.url.setupPagescroll(".mainwrapper")},b)},togglemenue:function(){$("nav").toggleClass("offleft"),$("#navbutton").toggleClass("navactive")},changeurl:function(a){$(".currentpage").removeClass("currentpage"),$($('a[href="'+a+'"]')[0].parentNode).addClass("currentpage")},correctSize:function(){$("#nav").width($($(".mainwrapper div")[0]).width())}},url:{init:function(){console.log("Bohdan"),app.options.previousURL=document.URL.split("#")[0],app.url.gotohashlocation()},seturlfromfull:function(a){var a=a.split("/"),b=a[a.length-1],a="/"+b;return window.history.pushState({id:b,path:a},b,a),app.nav.changeurl(a),app.options.previousURL=document.URL,!1},addajax:function(a){var b=a.split("/");""==b[b.length-1]&&b.length<5&&(b[b.length-1]="home");var c="ajax";return b.length<5?b[b.length-1]=c+b[b.length-1]:(b[b.length-2]=c+b[b.length-2],b[b.length-1]=""),b.join("/")},setupPagescroll:function(a){var b=$(a+" h2");b.waypoint(app.url.setSectionAsHash,{context:".mainwrapper"})},setSectionAsHash:function(a){"down"==a?$(this).hasClass("whitenav")?$("#navbutton").addClass("white"):$("#navbutton").removeClass("white"):$(this).hasClass("whitenav")?$("#navbutton").removeClass("white"):$("#navbutton").addClass("white")},slugify:function(a){return a.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")},gotohashlocation:function(){$(location.hash)},changepage:function(){var a=document.URL.split("#");if(0==a.length)app.nav.loadpage(document.URL,!0);else if(a[1].length>0&&0==$("#"+a[1]).length)app.property.loadproperty(null,a[1]);else if(0==a[1].length&&$(".module")){var b=$(".module")[0];b.parentNode.removeChild(b)}}},about:{init:function(){$(".reference").slick({dots:!0,arrows:!1}),app.property.setup()}},search:{init:function(){app.search.setuppriceSlider(),app.search.setupBedSlider(),app.search.setupBathSlider(),app.property.setup(),app.search.neighbourhoodSetup(),app.search.initajax()},initajax:function(){$("#searchlistings button").click(app.search.loadInitialContent),$("#morelistings").click(app.search.loadmorelistings)},loadmorelistings:function(){var a=$(this).find("input")[0].value;app.search.updatefrom(a),a.csrfmiddlewaretoken=propertySettings.csrftoken,$.ajax({type:"POST",url:"/proplist/",data:a,success:app.search.loadsuccessappend})},updatefrom:function(a){var b=a.split("=");b=b[b.length-1],a=a.substring(0,a.length-b.length),b=parseInt(b)+12,$("#morelistings input")[0].value=a+b},loadInitialContent:function(){var a=$(".filterform").serialize();app.search.updatefrom(a),a.csrfmiddlewaretoken=propertySettings.csrftoken,$.ajax({type:"POST",url:"/proplist/",data:a,success:app.search.loadsuccess})},loadsuccess:function(a){$("#searchresults ul").html(a),app.property.setup()},loadsuccessappend:function(a){$("#searchresults ul").append(a),app.property.setup()},responcefromInitialLoad:function(){console.log("submit was triggered")},setuppriceSlider:function(){var a=$(".offright #priceslider a");0==a.length&&(a=$("#priceslider")),a.noUiSlider({start:[0,8e5],connect:!0,behaviour:"drag",range:{min:[0],max:[15e5]},format:wNumb({mark:".",decimals:0,thousand:",",prefix:"$ "}),step:1e4}),a.Link("lower").to($("#lowerprice")),a.Link("upper").to($("#upperprice"))},setupBedSlider:function(){var a=$(".offright #bedslider");0==a.length&&(a=$("#bedslider")),a.noUiSlider({start:[1,3],connect:!0,behaviour:"drag",range:{min:[propertySettings.bed.min],max:[propertySettings.bed.max]},format:wNumb({mark:".",decimals:0}),step:1}),a.Link("lower").to($("#lowerbed")),a.Link("upper").to($("#upperbed"))},setupBathSlider:function(){var a=$(".offright #bathslider");0==a.length&&(a=$("#bathslider")),a.noUiSlider({start:[1,3],connect:!0,behaviour:"drag",range:{min:[propertySettings.bath.min],max:[propertySettings.bath.max]},format:wNumb({mark:".",decimals:1}),step:.5}),a.Link("lower").to($("#lowerbath")),a.Link("upper").to($("#upperbath"))},neighbourhoodSetup:function(){$("#neighbourhoods a").click(app.search.neighbourhoodClick)},neighbourhoodClick:function(a){return $("#neighbourhoodajax").load(this.href),a.preventDefault(),!1}},sell:{init:function(){console.log("sell setting up")}},property:{init:function(){$(".module").click(app.property.delete),$(".module > div > div").click(app.property.stopprop),app.property.resizemap(),app.property.coppyInit(),app.email.init()},initslick:function(){$(".propertyimages").slick({dots:!1,arrows:!0,slidesToShow:1,adaptiveHeight:!0})},resizemap:function(){var a=$("#gmap iframe");a.height(.8*a.width())},"delete":function(){this.parentNode&&(this.parentNode.removeChild(this),location.hash="")},setup:function(){$(".propertylist li a").click(app.property.loadproperty)},loadproperty:function(a,b){var c=this;if(a?a.preventDefault():c.href="/property/"+b,app.options.loadingpage)return!1;var d=document.createElement("div");return d.className="module",document.body.appendChild(d),$(d).load(c.href,app.property.loadedproperty),!1},stopprop:function(a){a.stopPropagation()},loadedproperty:function(){app.property.init(),location.hash=$(".module > div")[0].id},loadrestofphotos:function(a){console.log(a),$.ajax({dataType:"json",url:"/newimages/"+a,success:app.property.addednewimages})},addednewimages:function(a){for(var b="",c=1;c<a.count;++c)b+='<div><img src="/static/images/'+a.id+"-"+c+'.jpg"></div>';$(".propertyimages").html(b),app.property.initslick()},coppyInit:function(){var a=$(".coppylink");a.click(app.property.coppyclicked);var b=new ZeroClipboard(a);b.on("copy",function(a){console.log(a.target);var b=a.clipboardData;b.setData("text/plain",a.target.href)})},coppyclicked:function(a){return a.preventDefault(),!1}},email:{init:function(){$(".emailsubmit").click(app.email.submit)},submit:function(a){var b=$(this.parentNode).serialize();return console.log(b),$.ajax({type:"POST",url:"/sendemail/",data:b,success:app.email.submitsuccess}),a.preventDefault(),!1},submitsuccess:function(a){console.log(a)}},resize:function(){app.nav.correctSize(),app.property.resizemap()},getCookie:function(a){var b=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b},csrfSafeMethod:function(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}};